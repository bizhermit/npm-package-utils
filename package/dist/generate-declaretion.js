"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const fs_1=require("fs"),path_1=__importDefault(require("path")),utils_1=require("./utils"),generateDeclaretionFile=(e,t)=>{const r=JSON.parse((0,fs_1.readFileSync)(path_1.default.join(e,"package.json")).toString()).name;let i="";i=(0,utils_1.isAbsPath)(t?.outDir)?t?.outDir||"":path_1.default.join(e,t?.outDir??"src");let n="";const s=["node_modules","cli.ts",...t?.ignoreFileNames??[]],a=!0!==t?.quiet,o=t=>{(0,fs_1.readdirSync)(path_1.default.join(e,"src",t)).forEach((i=>{if(s.indexOf(i)>=0)return;if((0,fs_1.statSync)(path_1.default.join(e,"src",t,i)).isDirectory())return void o(path_1.default.join(t,i));const l=path_1.default.extname(i);if(".ts"!==l&&".tsx"!==l)return;if(i.endsWith("d.ts"))return;const u=i.substring(0,i.length-l.length),c=`${path_1.default.join(t,u).replace(/\\/g,"/").replace(/\/\//g,"/")}`,d=(0,fs_1.readFileSync)(path_1.default.join(e,"src",t,i)).toString().match(/export default ([A-Za-z][A-Za-z0-9$_]*)/)?.[1];null!=d&&0!==d.length?(n.length>0&&(n+="\n"),n+=`declare module "${r}/${c}" {\n  const ${d}: typeof import("./${c}");\n  // tslint:disable-next-line:export-just-namespace\n  export = ${d};\n}`,a&&process.stdout.write(`- ${i} >> ${d}\n`)):a&&process.stdout.write(`[skip] ${i}\n`)}))};o(""),(0,fs_1.existsSync)(i)||(0,fs_1.mkdirSync)(i,{recursive:!0}),(0,fs_1.writeFileSync)(path_1.default.join(i,t?.outName||"index.d.ts"),n)};exports.default=generateDeclaretionFile;